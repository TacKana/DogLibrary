name: Build the release version

on:
  push:
    tags:
      - v*.*.*
# ğŸ”‘ å…³é”®ä¿®å¤ï¼šæ·»åŠ æƒé™é…ç½®
permissions:
  contents: write # æˆäºˆåˆ›å»ºå‘å¸ƒçš„æƒé™

jobs:
  release:
    name: å¼€å§‹æ„å»º
    runs-on: ${{matrix.os}}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    steps:
      - name: æå–ä»£ç 
        uses: actions/checkout@v5
      - name: å®‰è£…nodejs
        uses: actions/setup-node@v5
        with:
          node-version: 22
      - name: å®‰è£…ä¾èµ–
        run: npm install
      - name: æ„å»ºlinux
        env:
          SNAPCRAFT_STORE_CREDENTIALS: ${{secrets.SNAPCRAFT_STORE_CREDENTIALS}}
        if: matrix.os == 'ubuntu-latest'
        run: |
          sudo snap install snapcraft --classic
          sudo apt-get update
          sudo apt-get install -y fakeroot
          npm run build:linux

      - name: æ„å»ºmacos
        if: matrix.os == 'macos-latest'
        run: npm run build:mac

      - name: æ„å»ºwindows
        if: matrix.os == 'windows-latest'
        run: npm run build:win
      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: build-artifacts-${{ matrix.os }}
          path: |
            dist/**/*
            !dist/node_modules/
          retention-days: 7

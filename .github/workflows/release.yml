name: Build the release version

on:
  push:
    tags:
      - v*.*.*
      
jobs:
  release:
    name: 开始构建
    runs-on: ${{matrix.os}}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    steps:
        - name: 提取代码
          uses: actions/checkout@v5
        - name: 安装nodejs
          uses: actions/setup-node@v5
          with:
            node-version: 22
        - name: 安装依赖
          run: npm install
        - name: 构建linux
          if: matrix.os == 'ubuntu-latest'
          run: npm run build:linux

        - name: 构建macos
          if: matrix.os == 'macos-latest'
          run: npm run build:mac

        - name: 构建windows
          if: matrix.os == 'windows-latest'
          run: npm run build:win
        - name: 发布
          uses: softprops/action-gh-release@v2
          with:
            draft: true
            files: |
              dist/*.exe
              dist/*.zip
              dist/*.dmg
              dist/*.AppImage
              dist/*.snap
              dist/*.deb
              dist/*.rpm
              dist/*.tar.gz
              dist/*.yml
              dist/*.blockmap
          env:
            GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}